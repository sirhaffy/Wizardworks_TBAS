
## Innehåll

**[01. Övergripande](01.%20Övergripande.md)**

**[02. Frontend](02.%20Frontend.md)**

**[03. Backend](03.%20Bäckend.md)**

**[04. Infrastruktur](04.%20Infrastruktur.md)** - Aktuell sida

---

# 04. Infrastruktur



## GitHub Actions CI/CD
dev.yml - Bygger och testar projektet.
pr-main.yml - Bygger och testar projektet.
main-deploy.yml - Bygger, testar och deployar projektet till Azure.

## Alternativa sätt att starta projektet

### 1. Starta projektet lokalt

1. Starta MongoDB med Docker Composer i root/ mappen.
```bash
docker compose up -d
```

2. Starta Backend i root/Backend mappen.
```bas
dotnet run
```

3. Starta Frontend i root/Frontend mappen.
```bash
yarn run dev
```

4. Yarn kommer ge url för att öppna sidan i webbläsaren.


## 2. Starta projektet i Azure
1. Skapa en fork av detta repo.
2. Lägg in era inställningar i Github Secrets enl nedan:

    1. Secrets som behövs:
    ```yaml
    AZURE_CREDENTIALS: <Azure Credentials>
    AZURE_SUBSCRIPTION_ID: <Azure Subscription ID>
    SSH_PRIVATE_KEY: <SSH key>
    ```

    2. För att komma åt Azure Credentials, gör följande:
        ```bash
          # 1. Logga in i Azure CLI.
          az login
       
          # 2. Skapa en ny service principal.
          az ad sp create-for-rbac --name "tbas-github-actions" --role contributor --scopes /subscriptions/
          {ERT-SUBSCRIPTION-ID} --sdk-auth
 
          # 3. Kopiera outputen { till } från ovanstående kommando och lägg in i Github Secrets AZURE_CREDENTIALS.
       
          # 4. Kopiera Azure Subscription ID därifrån också och lägg in i Github Secrets SUBSCRIPTION_ID.
       ```

    3. För att skapa en SSH key gör följande:
        ```bash
         # 1. Skapa ett nytt SSH-nyckelpar om du inte redan har ett.
         ssh-keygen -t rsa -b 4096 -f ~/.ssh/tbas_deploy_key
    
         # 2. Visa den privata nyckeln.
         cat ~/.ssh/tbas_deploy_key
    
         # 3. Kopiera nyckeln som visas från -----BEGIN OPENSSH PRIVATE KEY----- till -----END OPENSSH PRIVATE KEY-----,
         # viktigt att inga "trailing spaces" kopieras, och håll den hemlig.
    
         # 4. Lägg in nyckeln i Github Secrets SSH_PRIVATE_KEY.
       ```

3. Gör en liten ändring i dev eller annan branch som ni mergar till dev, och pusha till er fork, för att trigga Actions.

4. När den har gått igenom så gör en PR till main från dev.

5. När PR är godkänd och mergad så kommer den deployas till Azure, ni kan då se sajten på det publika IP numret från
   Azure på den VMen som skapades.

